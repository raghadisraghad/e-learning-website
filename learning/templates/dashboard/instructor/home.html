{% extends 'dashboard/instructor/base.html' %}
{% load static %}

{% block body %}
<div id="content-wrapper" class="content-wrapper">
    <div class="container-fluid">
        
        <!-- Welcome Banner -->
        <div class="welcome-banner">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <div class="welcome-text">
                        <h1 class="display-4 mb-2">
                            Welcome back, <span class="gradient-text">{{ user.first_name|default:user.username }}</span>!
                        </h1>
                        <p class="lead mb-0">
                            <i class="fas fa-calendar-alt me-2 text-primary"></i>
                            {{ current_date|date:"l, F j, Y" }}
                        </p>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="quick-actions text-lg-end">
                        <a href="{% url 'tutorial' %}" class="btn btn-primary btn-lg me-2" data-bs-toggle="tooltip" title="Create new tutorial">
                            <i class="fas fa-plus-circle me-2"></i>New Tutorial
                        </a>
                        <a href="{% url 'quiz_add' %}" class="btn btn-success btn-lg" data-bs-toggle="tooltip" title="Create new quiz">
                            <i class="fas fa-puzzle-piece me-2"></i>New Quiz
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards Row -->
        <div class="stats-row">
            <div class="row">
                <!-- Total Students Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card students-card">
                        <div class="stat-card-body">
                            <div class="stat-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ total_students|default:"0" }}</div>
                                <div class="stat-label">Total Students</div>
                            </div>
                            <div class="stat-trend positive">
                                <i class="fas fa-arrow-up"></i> {{ student_growth|default:"12" }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Courses Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card courses-card">
                        <div class="stat-card-body">
                            <div class="stat-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ total_courses|default:"0" }}</div>
                                <div class="stat-label">Active Courses</div>
                            </div>
                            <div class="stat-trend positive">
                                <i class="fas fa-arrow-up"></i> {{ course_growth|default:"8" }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Total Quizzes Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card quizzes-card">
                        <div class="stat-card-body">
                            <div class="stat-icon">
                                <i class="fas fa-puzzle-piece"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ total_quizzes|default:"0" }}</div>
                                <div class="stat-label">Total Quizzes</div>
                            </div>
                            <div class="stat-trend neutral">
                                <i class="fas fa-minus"></i> {{ quiz_growth|default:"0" }}%
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Average Score Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="stat-card score-card">
                        <div class="stat-card-body">
                            <div class="stat-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-content">
                                <div class="stat-value">{{ avg_score|default:"0" }}%</div>
                                <div class="stat-label">Avg. Quiz Score</div>
                            </div>
                            <div class="stat-trend {% if score_trend > 0 %}positive{% else %}negative{% endif %}">
                                <i class="fas fa-arrow-{% if score_trend > 0 %}up{% else %}down{% endif %}"></i> 
                                {{ score_trend|default:"0" }}%
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity & Quick Actions Row -->
        <div class="row">
            <!-- Recent Activity -->
            <div class="col-lg-8 mb-4">
                <div class="activity-card">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-history me-2 text-primary"></i>
                            <h5 class="mb-0">Recent Activity</h5>
                        </div>
                        <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
                    </div>
                    <div class="card-body">
                        <div class="activity-timeline">
                            {% if recent_activities %}
                                {% for activity in recent_activities %}
                                <div class="activity-item">
                                    <div class="activity-icon {{ activity.type }}">
                                        <i class="fas fa-{{ activity.icon }}"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">{{ activity.title }}</div>
                                        <div class="activity-meta">
                                            <span class="time"><i class="far fa-clock me-1"></i>{{ activity.time }}</span>
                                            <span class="status-badge {{ activity.status }}">{{ activity.status }}</span>
                                        </div>
                                    </div>
                                </div>
                                {% empty %}
                                <div class="text-center py-4">
                                    <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                    <p class="text-muted">No recent activities</p>
                                </div>
                                {% endfor %}
                            {% else %}
                                <!-- Sample activities for demonstration -->
                                <div class="activity-item">
                                    <div class="activity-icon success">
                                        <i class="fas fa-check"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">Quiz "Python Basics" completed by 15 students</div>
                                        <div class="activity-meta">
                                            <span class="time"><i class="far fa-clock me-1"></i>2 hours ago</span>
                                            <span class="status-badge success">Completed</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon primary">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">New tutorial "Advanced Django" published</div>
                                        <div class="activity-meta">
                                            <span class="time"><i class="far fa-clock me-1"></i>5 hours ago</span>
                                            <span class="status-badge primary">Published</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon warning">
                                        <i class="fas fa-exclamation-triangle"></i>
                                    </div>
                                    <div class="activity-content">
                                        <div class="activity-title">3 quizzes need review</div>
                                        <div class="activity-meta">
                                            <span class="time"><i class="far fa-clock me-1"></i>1 day ago</span>
                                            <span class="status-badge warning">Pending</span>
                                        </div>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions & Tips -->
            <div class="col-lg-4 mb-4">
                <div class="quick-tips-card">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-lightbulb me-2 text-warning"></i>
                            <h5 class="mb-0">Quick Tips</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="tips-carousel">
                            <div class="tip-item active">
                                <i class="fas fa-quote-right quote-icon"></i>
                                <p class="tip-text">Create engaging quizzes with images and multiple choice questions to keep students interested.</p>
                                <div class="tip-author">- Pro Tip</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-quote-right quote-icon"></i>
                                <p class="tip-text">Use video tutorials to explain complex topics. Students retain 95% more information.</p>
                                <div class="tip-author">- Best Practice</div>
                            </div>
                            <div class="tip-item">
                                <i class="fas fa-quote-right quote-icon"></i>
                                <p class="tip-text">Regular announcements keep students engaged. Try posting at least twice a week.</p>
                                <div class="tip-author">- Engagement Tip</div>
                            </div>
                        </div>
                        <div class="tips-nav text-center mt-3">
                            <span class="tip-dot active"></span>
                            <span class="tip-dot"></span>
                            <span class="tip-dot"></span>
                        </div>
                    </div>
                </div>

                <!-- Quick Links -->
                <div class="quick-links-card mt-4">
                    <div class="card-header">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-link me-2 text-primary"></i>
                            <h5 class="mb-0">Quick Links</h5>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="quick-links-grid">
                            <a href="{% url 'tutorial' %}" class="quick-link-item">
                                <i class="fas fa-video"></i>
                                <span>Add Tutorial</span>
                            </a>
                            <a href="{% url 'quiz_add' %}" class="quick-link-item">
                                <i class="fas fa-plus-circle"></i>
                                <span>Create Quiz</span>
                            </a>
                            <a href="{% url 'iadd_notes' %}" class="quick-link-item">
                                <i class="fas fa-file-alt"></i>
                                <span>Upload Notes</span>
                            </a>
                            <a href="{% url 'instructorallannonce' %}" class="quick-link-item">
                                <i class="fas fa-bullhorn"></i>
                                <span>Announcement</span>
                            </a>
                            <a href="{% url 'instructorprofile' %}" class="quick-link-item">
                                <i class="fas fa-user-cog"></i>
                                <span>Profile</span>
                            </a>
                            <a href="{% url 'quiz_change_list' %}" class="quick-link-item">
                                <i class="fas fa-list"></i>
                                <span>Manage Quizzes</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Info Bar (kept for backward compatibility) -->
        <div class="user-info-bar mt-4">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar-wrapper">
                            {% if user.avatar %}
                                <img src="{{ user.avatar.url }}" alt="{{ user.username }}" class="user-avatar">
                            {% else %}
                                <div class="user-avatar-placeholder">
                                    <i class="fas fa-user-circle"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="user-info ms-3">
                            <h5 class="mb-1">{{ user.get_full_name|default:user.username }}</h5>
                            <p class="mb-0 text-muted">
                                <i class="fas fa-envelope me-2"></i>{{ user.email }}
                                {% if user.phonenumber %}
                                <span class="ms-3"><i class="fas fa-phone me-2"></i>{{ user.phonenumber }}</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-md-end mt-3 mt-md-0">
                    <span class="badge bg-primary me-2">
                        <i class="fas fa-chalkboard-teacher me-1"></i>Instructor
                    </span>
                    <span class="badge bg-success">
                        <i class="fas fa-calendar-check me-1"></i>Member since {{ user.date_joined|date:"M Y" }}
                    </span>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // Tooltips initialization
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function(tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Tips carousel functionality
        const tips = document.querySelectorAll('.tip-item');
        const dots = document.querySelectorAll('.tip-dot');
        let currentTip = 0;

        function showTip(index) {
            tips.forEach(tip => tip.classList.remove('active'));
            dots.forEach(dot => dot.classList.remove('active'));
            tips[index].classList.add('active');
            dots[index].classList.add('active');
        }

        // Auto rotate tips every 5 seconds
        setInterval(() => {
            currentTip = (currentTip + 1) % tips.length;
            showTip(currentTip);
        }, 5000);

        // Click on dots to change tips
        dots.forEach((dot, index) => {
            dot.addEventListener('click', () => {
                currentTip = index;
                showTip(currentTip);
            });
        });
    });
</script>
{% endblock %}